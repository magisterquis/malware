#!/bin/sh
#
# build.sh
# Build malware
# By J. Stuart McMurray
# Created 20160221
# Last Modified 20160221

set -e

# Build go binaries
echo "Building Go binaries"
for d in *; do
        # Only care about directories
        if ! [ -d "$d" ]; then
                continue
        fi
        # Only care about directories with files 
        HAVE=0
        for f in ./$d/*.go; do
                if [ -f "$f" ]; then
                        HAVE=1
                        break
                fi
        done
        if [ "0" == "$HAVE" ]; then
                continue
        fi
        # Make the go binary in that directory
        cd "$d"
        for GOOS in windows linux openbsd darwin; do
                for GOARCH in 386 amd64; do
                        export GOOS GOARCH
                        N="$d.$GOOS.$GOARCH"
                        # Windows is special...
                        if [ "windows" == $GOARCH ]; then
                                N=$N.exe
                        fi
                        go build -o "$N"
                        (cd .. && ls -l "$d/$N")
                done
        done
        cd ..
done

