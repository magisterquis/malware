package main /*
 * fileserv.go
 * Simple http fileserver
 * By J. Stuart McMurray
 * Created 20160221
 * Last Modified 20160221
 */import (
	"flag"
	"fmt"
	"log"
	"net"
	"net/http"
	"os"
)

func main() {
	var (
		baseDir = flag.String(
			"d",
			"/",
			"Base `directory`",
		)
		addr = flag.String(
			"a",
			"0.0.0.0:0",
			"Listen `address` and optional port",
		)
	)
	flag.Usage = func() {
		fmt.Fprintf(
			os.Stderr,
			`Usage: %v [options]

Serves up files under the base directory on the given address.  A port of 0
will cause a port to be chosen at runtime.

Options:
`,
			os.Args[0],
		)
		flag.PrintDefaults()
	}
	flag.Parse()

	/* Listen on a port */
	l, err := net.Listen("tcp", *addr)
	if nil != err {
		log.Fatalf("Unable to listen on %q: %v", *addr, err)
	}
	log.Printf("Listening on %v", l.Addr())

	/* Serve up HTTP */
	if err := http.Serve(
		l,
		http.FileServer(http.Dir(*baseDir)),
	); nil != err {
		fmt.Fprintf(os.Stderr, "Error: %v", err)
		os.Exit(1)
	}
	log.Printf("Done.")
}
