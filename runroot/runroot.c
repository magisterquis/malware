/*
 * runroot.c
 * Escalate to root
 * By J. Stuart McMurray
 * Created 20160220
 * Last Modified 20160221
 */

#include <sys/types.h>
#include <err.h>
#include <unistd.h>

int main(int argc, char **argv) {
        /* Set {r,e}{u,g}id to root */
	setreuid(0,0);
	setregid(0,0);
        /* If we don't have anything in particular, call ourselves login -- */
        if (1 == argc) {
                if (-1 == execl("/bin/sh", "login --", NULL)) {
                        err(1, "execl");
                }
        }
        /* Use the first argument as our name */
        if (-1 == execl("/bin/sh", argv[1], NULL)) {
                err(2, "execl");
        }

        /* Shouldn't get here */
        errx(3, "wtf?");
	return 3;
}
