#!/bin/sh
#
# dorkbin
# Make symlinks that say No.
# By J. Stuart McMurray
# Created 20160223
# Last Modified 20160223

# Causes all non-shell-builtins to output "No."
# This is done by making a directory, putting a bunch of symlinks in it with
# the same names as files in the user's $PATH to a script that says "No.", and
# adding that directory to the user's $PATH via .bashrc and .profile.  Takes
# effect next time the user logs in, sources .profile, such.

# This script takes no arguments

# Directory into which to put commands
CMDDIR=${HOME}/.nocmds
NO=${CMDDIR}/saynodorkbin

# Make the directory to hold the symlinks
if ! [ -d $CMDDIR ]; then
        if ! mkdir -p $CMDDIR; then
                echo "Unable to make $CMDDIR" >&2
                exit 1
        fi
        echo Made $CMDDIR
fi

# Make No
echo "#!/bin/sh" > $NO
echo "echo 'No.'" >> $NO
chmod 755 $NO
echo "No -> $(ls $NO)"

# Symlink ALL the things
for d in $(echo "$PATH" | tr ":" "\n" | egrep -v '^\.$'); do
        for f in $d/*; do
                ln -s $NO ~/.nocmds/$(basename $f)
        done
        echo "Dorked $d"
done

# Make sure the dorked binaries are executed
for r in ${HOME}/.profile ${HOME}/.bashrc; do
        echo "export PATH=$CMDDIR:\$PATH" >> $r
done
